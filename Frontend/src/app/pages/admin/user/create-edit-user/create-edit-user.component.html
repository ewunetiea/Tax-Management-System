<form #userForm="ngForm" ngNativeValidate class="space-y-6">
  <!-- Name Fields -->
  <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div>
      <label for="first_name" class="block font-medium">
        <span class="text-red-600">*</span> First Name
      </label>
      <input
        id="first_name"
        type="text"
        name="first_name"
        [(ngModel)]="user.first_name"
        #first_name="ngModel"
        [class.border-red-600]="first_name.invalid && first_name.touched"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <small class="text-red-600" *ngIf="first_name.invalid && first_name.touched">First Name is required</small>
    </div>

    <div>
      <label for="middle_name" class="block font-medium">
        <span class="text-red-600">*</span> Middle Name
      </label>
      <input
        id="middle_name"
        type="text"
        name="middle_name"
        [(ngModel)]="user.middle_name"
        #middle_name="ngModel"
        [class.border-red-600]="middle_name.invalid && middle_name.touched"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <small class="text-red-600" *ngIf="middle_name.invalid && middle_name.touched">Middle Name is required</small>
    </div>

    <div>
      <label for="last_name" class="block font-medium">
        <span class="text-red-600">*</span> Last Name
      </label>
      <input
        id="last_name"
        type="text"
        name="last_name"
        [(ngModel)]="user.last_name"
        #last_name="ngModel"
        [class.border-red-600]="last_name.invalid && last_name.touched"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <small class="text-red-600" *ngIf="last_name.invalid && last_name.touched">Last Name is required</small>
    </div>
  </div>

  <!-- Gender & Phone -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <div>
      <span class="block font-medium mb-2"><span class="text-red-600">*</span> Gender</span>
      <div class="flex gap-6 items-center">
        <label class="flex items-center gap-2">
          <input type="radio" name="gender" value="Male" [(ngModel)]="user.gender" #gender="ngModel" class="form-radio" />
          Male
        </label>
        <label class="flex items-center gap-2">
          <input type="radio" name="gender" value="Female" [(ngModel)]="user.gender" #gender="ngModel" class="form-radio" />
          Female
        </label>
      </div>
      <small class="text-red-600" *ngIf="gender.invalid && gender.touched">Gender is required</small>
    </div>

    <div>
      <label for="phone_number" class="block font-medium">
        <span class="text-red-600">*</span> Phone Number
      </label>
      <input
        id="phone_number"
        type="tel"
        name="phone_number"
        [(ngModel)]="user.phone_number"
        #phone_number="ngModel"
        pattern="(\+251|0)(9|7)\d{8}"
        (input)="checkPhoneNumberStatus($event)"
        [class.border-red-600]="(phone_number.invalid && phone_number.touched) || phone_number_status"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <div *ngIf="phone_number_status">
        <small class="text-red-600">Phone Number Already Exists</small>
      </div>
      <div *ngIf="phone_number.errors && phone_number.touched">
        <small class="text-red-600" *ngIf="phone_number.errors['required']">Phone number is required</small>
        <small class="text-red-600" *ngIf="phone_number.errors['pattern']">Phone number not valid or should start with +251, 09 or 07</small>
      </div>
    </div>
  </div>

  <!-- Employee ID & Email -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <div>
      <label for="employee_id" class="block font-medium">
        <span class="text-red-600">*</span> Awash Bank ID
      </label>
      <input
        id="employee_id"
        type="text"
        name="employee_id"
        [(ngModel)]="user.employee_id"
        #employee_id="ngModel"
        pattern="^(AB|AIB|aib|ab)\/(\d{1,7})\/(19|20|21)\d{2}$"
        (input)="checkAwashBankIdStatus($event)"
        [class.border-red-600]="(employee_id.invalid && employee_id.touched) || employee_id_status || employee_id_status_system"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <small class="text-red-600" *ngIf="employee_id.errors && employee_id.touched">
        <span *ngIf="employee_id.errors['required']">Awash Bank ID is required</span>
        <span *ngIf="employee_id.errors['pattern']">Awash ID Incorrect</span>
      </small>
      <small class="text-red-600" *ngIf="employee_id_status">This ID Does not exist!</small>
      <small class="text-red-600" *ngIf="employee_id_status_system">User Already registered!</small>
    </div>

    <div *ngIf="!employee_id_status && proceed && !(employee_id.errors && employee_id.touched)">
      <label for="email" class="block font-medium">
        <span class="text-red-600">*</span> Outlook Address
      </label>
      <input
        id="email"
        type="text"
        name="email"
        [(ngModel)]="user.email"
        #email="ngModel"
        pattern="\w+(\.\w+)?&#64;awashbank\.com$"
        (input)="checkEmailStatus($event)"
        [class.border-red-600]="(email.invalid && email.touched) || email_status"
        class="w-full border rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300"
      />
      <small class="text-red-600" *ngIf="email_status">Outlook Address Already Exists</small>
      <small class="text-red-600" *ngIf="email.errors && email.touched">
        <span *ngIf="email.errors['required']">Outlook Address is required</span>
        <span *ngIf="email.errors['pattern']">Outlook Address should end with &#64;awashbank.com</span>
      </small>
    </div>
  </div>

  <!-- Save/Reset Buttons -->
  <div class="flex gap-4 mt-6">
    <button
      type="button"
      (click)="openModal()"
      [disabled]="userForm.invalid || !proceed || phone_number_status || email_status || employee_id_status_system"
      class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-2 rounded"
    >
      Save
    </button>
    <button type="reset" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-6 py-2 rounded">Reset</button>
  </div>
</form>

<!-- Confirmation Dialog -->
<p-dialog [(visible)]="confrimationDialog" header="Confirm User's information" [modal]="true" styleClass="p-fluid" [maximizable]="true">
  <ng-template pTemplate="content">
    <div class="space-y-2">
      <p><strong>First Name:</strong> {{ user.first_name }}</p>
      <p><strong>Middle Name:</strong> {{ user.middle_name }}</p>
      <p><strong>Last Name:</strong> {{ user.last_name }}</p>
      <p><strong>Gender:</strong> {{ user.gender }}</p>
      <p><strong>Phone Number:</strong> {{ user.phone_number }}</p>
      <p><strong>Employee ID:</strong> {{ user.employee_id }}</p>
      <p><strong>Email:</strong> {{ user.email }}</p>
      <p><strong>Job Title:</strong> {{ user.jobPosition?.title }}</p>
      <p *ngIf="user.region?.name"><strong>Place of Work:</strong> {{ user.region?.name }}</p>
      <p *ngIf="user.branch?.name"><strong>Place of Work:</strong> {{ user.branch?.name }}</p>
      <p><strong>User Category:</strong> {{ user.category }}</p>
      <p><strong>{{ user.category == 'BFA' || user.category == 'INS' ? 'Banking Category' : 'Management Audit' }}:</strong> {{ user.banking }}</p>
      <p><strong>Authentication Media:</strong> {{ user.authenthication_media || user.phone_number }}</p>
    </div>
  </ng-template>
  <ng-template pTemplate="footer">
    <button *ngIf="!loading" pButton pRipple label="Save" icon="pi pi-check" class="p-button-text" (click)="addUser()"></button>
    <button *ngIf="loading" disabled class="bg-blue-500 text-white px-4 py-2 rounded flex items-center gap-2">
      Loading...
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
    </button>
    <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
  </ng-template>
</p-dialog>
