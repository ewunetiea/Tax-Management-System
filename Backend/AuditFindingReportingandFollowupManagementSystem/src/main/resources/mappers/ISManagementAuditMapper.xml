<!-- src/main/resources/mappers/ISManagementAuditMapper.xml -->
<mapper namespace="com.afr.fms.Common.Report.IS_Report.Mapper.ISManagementAuditMapper">

    <!-- Define your result map for IS_Management_Audit and Audtiee_Division_ISM columns -->

    <select id="searchISManagementAudit" resultMap="isManagementAuditResultMap">
        SELECT
            
            ism.*

        FROM [IS_Management_Audit] ism
        INNER JOIN [IS_MGT_Auditee] ima ON ism.id = ima.IS_MGT_id
        LEFT JOIN [Audtiee_Division_ISM] adi ON ima.id = adi.IS_MGT_Auditee_id
        WHERE
            <if test="role == 'auditor'">
                ism.auditor_id = #{userId} AND ism.category = #{category}
            </if>
            <if test="role == 'approver'">
                ism.approver_id = #{userId} AND ism.category = #{category}
            </if>
            <if test="finding != null">
                AND ism.finding = #{finding}
            </if>
            <if test="riskLevel != null">
                AND ism.risk_level = #{riskLevel}
            </if>
            <if test="findingStatus != null">
                AND ism.finding_status = #{findingStatus}
            </if>
            <if test="findingDate != null">
                AND ism.finding_date = #{findingDate}
            </if>
            <!-- Include other conditions based on optional parameters -->

    </select>

</mapper>
